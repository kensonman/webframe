{%extends 'webframe/base.html'%}{%load i18n static pref%}

{%block title%}{%trans 'Login Required'%}{%endblock%}

{%block scripts-blk%}
<style type="text/css">
.btn-login{ min-width: 200px; min-height: 40px; display:inline-block;}
.seperator{ border-bottom: 1px solid black; text-align: center; margin-bottom:20px;}
.seperator span{ position:relative; top:1rem; background-color:white; padding:10px;}
ul.ul-messages{}
ul.ul-messages li{}
</style>
{%endblock%}

{%block loading-blk%}
<script type="text/javascript"><!--
Webframe.URL_AUTHENTICATION='{%url "webframe:webauthn-authentication"%}';
Webframe.URL_LOGIN='{%url "webframe:login"%}';
/* Translation - make sure the translation is ready for javascript*/
/* 
 * {%trans 'Loading authentication options from server...'%}
 * {%trans 'Got authentication options, authenticating...'%}
 * {%trans 'Authenticated, verification in progress...'%}
 * {%trans 'Got server verification result'%}
 * {%trans 'Authentication successful, the page will be redirected soon...'%}
 * {%trans 'It may be username/password mismatched'%}
 * {%blocktrans with error='{error}'%}Authentication failure: {{error}}{%endblocktrans%}
 */
</script>

<script type="text/javascript" src="{%static 'webframe/js/webauthn-authentication.js'%}"></script>
{%endblock%}


{%block content%}
<div class="jumbotron">
	<div class="row">
		<div class="col-md-6 offset-md-3 col-12">
         <form method="POST" id="loginFrm" class="card card-danger">
            <input type="hidden" name="authenticating" value="pubkey"/>
            <div class="card-header bg-danger">{%trans 'Login Required'%}</div>
            <div class="card-body">
               {%csrf_token%}
               
               {%block socialLogin%}
               <div class="pnl-socialAuth">
                  {%block loginMethods%}
                  {%if socialLogin_facebook%}<div class="btn-login">
                     <a href="{%url 'social:begin' 'facebook'%}"><img src="{%static 'img/webframe/login-facebook.png'%}" alt="{%trans 'login-facebook'%}"/></a>
                  </div>{%endif%}
                  {%if socialLogin_twitter%}<div class="btn-login">
                     <a href="{%url 'social:begin' 'twitter'%}"><img src="{%static 'img/webframe/login-twitter.png'%}" alt="{%trans 'login-twitter'%}"/></a>
                  </div>{%endif%}
                  {%if socialLogin_github%}<div class="btn-login">
                     <a href="{%url 'social:begin' 'github'%}"><img src="{%static 'img/webframe/login-github.png'%}" alt="{%trans 'login-github'%}"/></a>
                  </div>{%endif%}
                  {%if socialLogin_google%}<div class="btn-login">
                     <a href="{%url 'social:begin' 'google-oauth2'%}"><img src="{%static 'img/webframe/login-google.png'%}" alt="{%trans 'login-google'%}"/></a>
                  </div>{%endif%}
                  {%endblock%}
               </div>

               {%if socialLogin_facebook or socialLogin_twitter or socialLogin_github or socialLogin_google%}<div class="seperator"><span>{%trans 'OR'%}</span></div>{%endif%}
               {%endblock%}

               <input type="hidden" name="next" value="{{next|default:'/'}}"/>

               {%block authenticationBackendsBlock%}<div class="field form-group">
                  <label for="backendsFld">{%trans 'Authentication Backends'%}</label>
                  <ul>
                     {%for b in backends%}<li>{{b}}</li>{%endfor%}
                  </ul>
               </div>{%endblock%}

               {%block loginFlds-blk%}<section name="loginFlds">
                  <div id="msgPnlHere"></div>
                  {%if IPAddrFld|default:True in TRUE_VALUES%}<div class="field form-group">
                     <label for="IPAddrFld" class="desktop-only">{%trans 'IPAddr'%}</label>
                     <input type="text" name="ipaddr" value="{{IPAddr}}" class="form-control" id="IPAddrFld" readonly="readonly" required="required"/>
                  </div>{%endif%}
                  <div class="field form-group">
                     <label for="usernameFld" class="desktop-only">{%trans 'username'%}</label>
                     <div class="input-group">
                        <input type="text" name="username" id="usernameFld" class="form-control" autocomplete="username" value="{{username|default:''}}" placeholder="{%trans 'username'%}" required="required"/>
                        <input type="hidden" name="authenticator" class="platform"/>
                        <button type="button" class="btn btn-outline-warning" title="{%trans 'thru password login'%}" id="loginWithPwdBtn"><i class="fas fa-key"></i></button>
                        <button type="reset" class="btn btn-outline-secondary"><i class="fas fa-undo"></i></button>
                     </div>
                  </div>
                  <div class="field form-group d-none" id="field-password">
                     <label for="current-passwordFld" class="desktop-only">{%trans 'password'%}</label>
                     <input type="password" name="current-password" id="current-passwordFld" class="form-control" autocomplete="current-password" placeholder="{%trans 'password'%}"/>
                  </div>
                  <div class="pnl-btns">
                     {%if TMPL_RESET_PASSWORD%}<a class="btn btn-outline-secondary" href="{%url 'webframe:resetPassword'%}" target='_self'>{%trans 'resetPassword'%}</a>{%endif%}
                     {%if WEBFRAME_ALLOW_REGISTRATION%}<a class="btn btn-outline-info" href="{%url 'webframe:webauthn-registration'%}">{%trans 'registration'%}</a>{%endif%}
                     <button class="btn btn-success" type="submit" id="loginBtn" disabled="disabled"><i class="fas fa-passport"></i> {%trans 'login'%}</button>
                  </div>
               </section>{%endblock%}

               {%block resetPwd-blk%}{%endblock%}

               {%block registration-blk%}{%endblock%}
            </div>
            <div class="card-footer">
            </div>
         </form>

      </div>
	</div>
	
</div>
{%endblock%}
